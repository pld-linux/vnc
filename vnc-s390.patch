--- vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/os-support/linux/lnx_video.c.s390	2005-09-19 19:38:26.000000000 +0100
+++ vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/os-support/linux/lnx_video.c	2005-12-21 12:29:17.000000000 +0000
@@ -64,7 +64,9 @@
 #elif !defined(__powerpc__) && \
       !defined(__mc68000__) && \
       !defined(__sparc__) && \
-      !defined(__mips__)
+      !defined(__mips__) && \
+      !defined(__s390__) && \
+      !defined(__s390x__)
 
 /*
  * Due to conflicts with "compiler.h", don't rely on <sys/io.h> to declare
@@ -569,7 +571,7 @@
 #endif
 	}
 	close(fd);
-#elif !defined(__mc68000__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__hppa__)
+#elif !defined(__mc68000__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__hppa__) && !defined(__s390__) && !defined(__s390x__)
         if (ioperm(0, 1024, 1) || iopl(3)) {
                 if (errno == ENODEV)
                         ErrorF("xf86EnableIOPorts: no I/O ports found\n");
@@ -596,7 +598,7 @@
 #if defined(__powerpc__)
 	munmap(ioBase, 0x20000);
 	ioBase = NULL;
-#elif !defined(__mc68000__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__hppa__)
+#elif !defined(__mc68000__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__hppa__) && !defined(__s390__) && !defined(__s390x__)
 	iopl(0);
 	ioperm(0, 1024, 0);
 #endif
@@ -615,12 +617,12 @@
 Bool
 xf86DisableInterrupts()
 {
-#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__ia64__) && !defined(__sh__) && !defined(__hppa__)
+#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__ia64__) && !defined(__sh__) && !defined(__hppa__) && !defined(__s390__) && !defined(__s390x__)
 	if (!ExtendedEnabled)
 	    if (iopl(3) || ioperm(0, 1024, 1))
 			return (FALSE);
 #endif
-#if defined(__alpha__) || defined(__mc68000__) || defined(__powerpc__) || defined(__sparc__) || defined(__mips__) || defined(__arm__) || defined(__sh__) || defined(__ia64__) || defined(__hppa__)
+#if defined(__alpha__) || defined(__mc68000__) || defined(__powerpc__) || defined(__sparc__) || defined(__mips__) || defined(__arm__) || defined(__sh__) || defined(__ia64__) || defined(__hppa__) || defined(__s390__) || defined(__s390x__)
 #else
 # ifdef __GNUC__
 #  if defined(__ia64__)
@@ -634,7 +636,7 @@
 	asm("cli");
 # endif
 #endif
-#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__ia64__) && !defined(__hppa__)
+#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__ia64__) && !defined(__hppa__) && !defined(__s390__) && !defined(__s390x__)
 	if (!ExtendedEnabled) {
 	    iopl(0);
 	    ioperm(0, 1024, 0);
@@ -647,12 +649,12 @@
 void
 xf86EnableInterrupts()
 {
-#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__ia64__) && !defined(__sh__) && !defined(__hppa__)
+#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__ia64__) && !defined(__sh__) && !defined(__hppa__) && !defined(__s390__) && !defined(__s390x__)
 	if (!ExtendedEnabled)
 	    if (iopl(3) || ioperm(0, 1024, 1))
 			return;
 #endif
-#if defined(__alpha__) || defined(__mc68000__) || defined(__powerpc__) || defined(__sparc__) || defined(__mips__) || defined(__arm__) || defined(__sh__) || defined(__ia64__) || defined(__hppa__)
+#if defined(__alpha__) || defined(__mc68000__) || defined(__powerpc__) || defined(__sparc__) || defined(__mips__) || defined(__arm__) || defined(__sh__) || defined(__ia64__) || defined(__hppa__) || defined(__s390__) || defined(__s390x__)
 #else
 # ifdef __GNUC__
 #  if defined(__ia64__)
@@ -666,7 +668,7 @@
 	asm("sti");
 # endif
 #endif
-#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__ia64__) && !defined(__hppa__)
+#if !defined(__mc68000__) && !defined(__powerpc__) && !defined(__sparc__) && !defined(__mips__) && !defined(__sh__) && !defined(__ia64__) && !defined(__hppa__) && !defined(__s390__) && !defined(__s390x__)
 	if (!ExtendedEnabled) {
 	    iopl(0);
 	    ioperm(0, 1024, 0);
--- vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/os-support/misc/SlowBcopy.c.s390	2005-07-03 08:01:34.000000000 +0100
+++ vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/os-support/misc/SlowBcopy.c	2005-12-21 12:29:17.000000000 +0000
@@ -36,7 +36,9 @@
 #if !defined(__sparc__) && \
     !defined(__powerpc__) && \
     !defined(__mips__) && \
-    !defined(__ia64__)
+    !defined(__ia64__) && \
+    !defined(__s390__) && \
+    !defined(__s390x__)
 	outb(0x80, 0x00);
 #endif
     }
--- vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/int10/Makefile.am.s390	2005-12-02 06:02:41.000000000 +0000
+++ vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/int10/Makefile.am	2005-12-21 12:29:46.000000000 +0000
@@ -27,7 +27,8 @@
 endif
 
 if INT10_STUB
-AM_CFLAGS = -D_PC -D_VM86_LINUX $(XORG_CFLAGS) $(EXTRA_CFLAGS)
+AM_CFLAGS = -D_PC -D_VM86_LINUX $(XORG_CFLAGS) $(EXTRA_CFLAGS) \
+	-I../common -I../os-support -I../os-support/bus
 libint10_la_SOURCES = stub.c xf86int10module.c
 endif
 
--- vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/common/xf86Bus.c.s390	2005-07-03 09:53:42.000000000 +0100
+++ vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/common/xf86Bus.c	2005-12-21 12:29:17.000000000 +0000
@@ -3078,7 +3078,7 @@
 CheckGenericGA()
 {
 /* This needs to be changed for multiple domains */
-#if !defined(__sparc__) && !defined(__powerpc__) && !defined(__mips__) && !defined(__ia64__)
+#if !defined(__sparc__) && !defined(__powerpc__) && !defined(__mips__) && !defined(__ia64__) && !defined(__s390__) && !defined(__s390x)
     IOADDRESS GenericIOBase = VGAHW_GET_IOBASE();
     CARD8 CurrentValue, TestValue;
 
--- vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/common/xf86Helper.c.s390	2005-07-03 09:53:42.000000000 +0100
+++ vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/common/xf86Helper.c	2005-12-21 12:29:17.000000000 +0000
@@ -2069,6 +2069,7 @@
 	      void (*BlankScreen)(ScrnInfoPtr, Bool), IOADDRESS vertsyncreg,
 	      int maskval, int knownclkindex, int knownclkvalue)
 {
+#if !defined(__s390__) && !defined(__s390x__)
     register int status = vertsyncreg;
     unsigned long i, cnt, rcnt, sync;
 
@@ -2162,6 +2163,7 @@
 
     /* Restore registers that were written on */
     (*ClockFunc)(pScrn, CLK_REG_RESTORE);
+#endif /* !defined(__s390__) && !defined(__s390x__) */
 }
 
 void
--- vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/common/compiler.h.s390	2005-11-08 06:33:28.000000000 +0000
+++ vnc-4_1_1-unixsrc/unix/xorg-server-1.0.0/hw/xfree86/common/compiler.h	2005-12-21 12:29:17.000000000 +0000
@@ -1355,6 +1355,15 @@
     : "0" (_beg), "r" (_end), "r" (_flg));				\
 } while (0)
 
+#   elif defined(__s390__) || defined(__s390x__)
+
+#define inb(x) (0)
+#define inw(x) (0)
+#define inl(x) (0)
+#define outb(x,y) (0)
+#define outw(x,y) (0)
+#define outl(x,y) (0)
+
 #   else /* ix86 */
 
 #    define ldq_u(p)	(*((unsigned long  *)(p)))
